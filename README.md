---
# **OptiCar - Real-Time Car Monitoring**

OptiCar is a real-time monitoring solution for car manufacturing allowing for performance tracking, anomaly detection, and management of alerts and tasks through an intuitive interface. The application uses InfluxDB for time-series data storage and webhooks to receive machine data every 20 seconds.
---

## **Table of Contents**

1. [Features](#features)
2. [Prerequisites](#prerequisites)
3. [Installation](#installation)
   - [InfluxDB](#influxdb)
   - [Backend (Express.js)](#backend-expressjs)
   - [Frontend (Next.js)](#frontend-nextjs)
4. [Starting](#starting)
5. [Webhook Configuration](#webhook-configuration)
6. [Technologies Used](#technologies-used)

---

## **Features**

- Real-time tracking of machines (temperature, consumption, etc.).
- Detection of critical thresholds and automatic alert generation.
- Data visualization via WebSocket for instant updates.
- Task and alert management generated by machine events.
- Addition and configuration of machines with custom thresholds.

---

## **Prerequisites**

Before you begin, ensure you have the following installed on your machine:

- **Node.js** (v14.x or later) and **npm** or **yarn**
- **InfluxDB** v2 (for time-series data storage)
- **SQLite** (or another DBMS supported by Prisma)
- **VSCode** (recommended for port forwarding and configuration)

---

## **Installation**

### **InfluxDB**

1. Download and install InfluxDB from the official site: [InfluxDB Download](https://www.influxdata.com/downloads/).

2. Access **http://localhost:8086** in your browser to configure InfluxDB.

3. **Create a bucket** named **testOuanes** (under "Data > Buckets").

4. **Create a full access token** (under "Data > Tokens"). Note the token, as you will need it later.

5. **Save the organization name** (visible on the InfluxDB dashboard).

6. **Upload CSV files** containing machine data (under "Data > Sources"). Select your **testOuanes** bucket during the upload. You can download a sample CSV file [here](https://drive.google.com/file/d/1LGFipNDFvcrz62H5vh6AeT-vyYvH2BGD/view?usp=drive_link) (replace with actual link).

### **Backend (Express.js)**

1. **Clone the backend repository**:

   ```bash
   git clone https://github.com/Raoul-Merhab/Opti-CAR-Back.git
   ```

2. **Install dependencies**:

   ```bash
   npm install
   ```

3. **Install Prisma client**:

   ```bash
   npm install @prisma/client
   ```

4. **Generate Prisma files**:

   ```bash
   npx prisma generate
   ```

5. **Configure the `.env` file**:

   Create a `.env` file at the root of the project and add the following variable:

   ```bash
   DB_URL="file:./opticar.db"
   ```

6. **Configure InfluxDB in the `influxdb-config.js` file**:

   Update the values for **token**, **org**, and **bucket** in the `influxdb-config.js` file with those generated and saved during the InfluxDB installation.

7. **Start the Express server**:

   ```bash
   npm run dev
   ```

8. **Forward port 5424 on VSCode** to make Express publicly accessible (necessary for webhooks). Ensure the port is publicly visible and copy the URL.

### **Frontend (Next.js)**

1. **Clone the frontend repository**:

   ```bash
   git clone https://github.com/Raoul-Merhab/Opti-CAR-Front.git
   cd opticar-frontend
   ```

2. **Update the backend URL in the API configuration**:
   Ensure the backend URL is correctly set in the API configuration of the frontend (src/api/Urls.js)

3. **Install dependencies**:

   ```bash
   npm install
   ```

4. **Start the Next.js server**:
   ```bash
   npm run dev
   ```

The frontend will be available at **http://localhost:3000**.

---

## **Starting**

Once all installation steps are completed:

1. **Backend**: The Express server should be started via `npm run dev` (port 5424).
2. **Frontend**: The Next.js frontend is available at **http://localhost:3000**.
3. **InfluxDB**: Ensure that the bucket and organization are configured and that the data is available in the bucket.

---

## **Webhook Configuration**

1. Use the link generated after making your backend public (port forwarding in VSCode). This link will be used as the **callback URL** for each machine.

2. **Subscribe to the webhook** for different machines using the Express API. Example request to subscribe a machine:

   ```bash
   POST /api/machines/webhook
   {
     "machine": "welding_robot_006",
     "callback_url": "your_public_link/backend-webhook-url"
   }
   ```

3. Repeat this operation for the 6 machines available in your project.

---

## **Technologies Used**

- **Node.js / Express.js**: Backend for the API and webhook management.
- **Prisma**: ORM for interacting with the SQLite database.
- **InfluxDB**: Time-series database for storing machine data.
- **Next.js**: React framework for the frontend.
- **WebSocket**: Used for real-time updates of machine data.
- **JWT**: Used for user authentication and role management.
